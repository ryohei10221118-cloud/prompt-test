<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è§’è‰²æç¤ºç®¡ç†å·¥å…· v3.0ï¼ˆé›²ç«¯å…±äº«ç‰ˆï¼‰</title>

  <style>
    body {
      background: #f7f8fc;
      font-family: "Noto Sans TC", "Segoe UI", sans-serif;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #4b4ba5;
      color: #fff;
      padding: 12px 20px;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    header h1 {
      font-size: 1.4rem;
      font-weight: 700;
    }

    header .user-info {
      position: relative;
    }

    header .user-info button {
      background: #6f6fe0;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.25s ease;
    }

    header .user-info button:hover {
      background: #5a5ad8;
    }

    /* ======= ä¸‹æ‹‰é¸å–® ======= */
    #userMenu {
      position: absolute;
      right: 0;
      top: 40px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 8px 0;
      width: 140px;
      display: none;
      z-index: 20;
    }

    #userMenu ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #userMenu li {
      padding: 10px 14px;
      cursor: pointer;
      color: #333;
      font-weight: 500;
      transition: background 0.2s;
    }

    #userMenu li:hover {
      background: #f1f0ff;
      color: #4b4ba5;
    }

    /* ======= å°è¦½åˆ— ======= */
    .nav-scroll {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      background: transparent;
      padding: 10px 16px;
      white-space: nowrap;
      border-bottom: 2px solid rgba(108, 99, 255, 0.3);
      position: sticky;
      top: 60px;
      z-index: 10;
    }

    .nav-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .nav-scroll::-webkit-scrollbar-thumb {
      background: rgba(108, 99, 255, 0.4);
      border-radius: 10px;
    }

    .nav-scroll button {
      background: rgba(108, 99, 255, 0.15);
      border: none;
      padding: 6px 14px;
      border-radius: 10px;
      font-weight: 600;
      color: #3a328f;
      cursor: pointer;
      transition: 0.2s;
    }

    .nav-scroll button:hover {
      background: rgba(108, 99, 255, 0.25);
      transform: translateY(-2px);
    }

    /* ======= åˆ†é¡å¡ç‰‡ ======= */
    .category {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
      margin: 24px auto;
      padding: 18px 24px;
      width: 90%;
      max-width: 1000px;
      transition: all 0.3s ease;
    }

    .category h2 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 1.1rem;
      color: #4b4ba5;
      border-bottom: 1px solid #ccc;
      padding-bottom: 6px;
    }

    .category-buttons {
      display: flex;
      gap: 10px;
    }

    .add-btn {
      background: #6f6fe0;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: 0.25s ease;
      font-weight: 600;
    }

    .add-btn:hover {
      background: #5b5bd0;
    }

    .delete-cat-btn {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: 0.25s ease;
      font-weight: 600;
    }

    .delete-cat-btn:hover {
      background: #d03528;
    }

    /* ======= è§’è‰²å°å¡ ======= */
    .category-card {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .category-card .item {
      flex: 1 1 calc(50% - 10px);
      background: #f9f9ff;
      border: 1px solid #e0e0ff;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 500;
      position: relative;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      cursor: pointer;
    }

    .category-card .item:hover {
      transform: translateY(-3px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    }

    .delete-char {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      color: #e74c3c;
      font-size: 1.1rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .delete-char:hover {
      transform: scale(1.2);
    }

    /* ======= å½ˆå‡ºè¦–çª— ======= */
    .modal-box {
      background: linear-gradient(180deg, #ffffff, #f9f9ff);
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      padding: 20px 30px;
      max-width: 460px;
      width: 100%;
      margin: auto;
      border-top: 4px solid #6f6fe0;
    }

    .modal-box h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: #4b4ba5;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-box h3 button {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #999;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .modal-box h3 button:hover {
      color: #555;
    }

    @media (max-width: 768px) {
      .category-card .item {
        flex: 1 1 100%;
      }
      .nav-scroll button {
        font-size: 0.85rem;
        padding: 5px 10px;
      }
      .modal-box {
        width: 90%;
        padding: 16px;
      }
    }
  </style>
</head>

  <body>
  <header>
    <h1>è§’è‰²æç¤ºç®¡ç†å·¥å…· v3.0ï¼ˆé›²ç«¯å…±äº«ç‰ˆï¼‰</h1>
    <div class="user-info">
      <button id="loginBtn">ç™»å…¥</button>
      <div id="userMenu" class="hidden">
        <ul>
          <li id="suggestBtn">ğŸ’¬ å°å»ºè­°</li>
          <li id="logoutBtn">ç™»å‡º</li>
        </ul>
      </div>
    </div>
  </header>

  <!-- ğŸ”¹å°è¦½åˆ— -->
  <div class="nav-scroll" id="navBar">
    <button onclick="scrollToCategory('characters')">è§’è‰²æè¿°</button>
    <button onclick="scrollToCategory('style')">å…‰å½±é¢¨æ ¼</button>
    <button onclick="scrollToCategory('outfit')">æœè£é¢¨æ ¼</button>
    <button onclick="scrollToCategory('hair')">é«®å‹è¨­è¨ˆ</button>
    <button onclick="scrollToCategory('color')">é…è‰²æ–¹æ¡ˆ</button>
  </div>

  <!-- ğŸ”¹è§’è‰²æè¿° -->
  <section id="characters" class="category">
    <h2>
      <span>ğŸ§â€â™‚ï¸ è§’è‰²æè¿°</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('characters')">ï¼‹æ–°å¢</button>
      </div>
    </h2>
    <div class="category-card" id="characters-list"></div>
  </section>

  <!-- ğŸ”¹å…‰å½±é¢¨æ ¼ -->
  <section id="style" class="category">
    <h2>
      <span>ğŸ¨ å…‰å½±é¢¨æ ¼</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('style')">ï¼‹æ–°å¢</button>
      </div>
    </h2>
    <div class="category-card" id="style-list"></div>
  </section>

  <!-- ğŸ”¹æœè£é¢¨æ ¼ -->
  <section id="outfit" class="category">
    <h2>
      <span>ğŸ‘— æœè£é¢¨æ ¼</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('outfit')">ï¼‹æ–°å¢</button>
      </div>
    </h2>
    <div class="category-card" id="outfit-list"></div>
  </section>

  <!-- ğŸ”¹é«®å‹è¨­è¨ˆ -->
  <section id="hair" class="category">
    <h2>
      <span>ğŸ’‡â€â™€ï¸ é«®å‹è¨­è¨ˆ</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('hair')">ï¼‹æ–°å¢</button>
      </div>
    </h2>
    <div class="category-card" id="hair-list"></div>
  </section>

  <!-- ğŸ”¹é…è‰²æ–¹æ¡ˆ -->
  <section id="color" class="category">
    <h2>
      <span>ğŸ¨ é…è‰²æ–¹æ¡ˆ</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('color')">ï¼‹æ–°å¢</button>
      </div>
    </h2>
    <div class="category-card" id="color-list"></div>
  </section>

  <!-- ğŸ”¹å°å»ºè­° -->
  <dialog id="suggestModal" class="modal-box">
    <h3>ğŸ’¬ å°å»ºè­° <button onclick="closeModal('suggestModal')">âœ•</button></h3>
    <textarea id="suggestText" rows="4" placeholder="è«‹è¼¸å…¥æ‚¨çš„å»ºè­°..." style="width:100%;margin-top:10px;border-radius:8px;border:1px solid #ccc;padding:8px;"></textarea>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;">
      <button onclick="submitSuggestion()" style="background:#6f6fe0;color:white;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">é€å‡º</button>
      <button onclick="closeModal('suggestModal')" style="background:#ccc;color:black;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">å–æ¶ˆ</button>
    </div>
  </dialog>

  <!-- ğŸ”¹æ–°å¢è§’è‰² -->
  <dialog id="addCharModal" class="modal-box">
    <h3>æ–°å¢è§’è‰² <button onclick="closeModal('addCharModal')">âœ•</button></h3>
    <input type="text" id="charName" placeholder="è§’è‰²åç¨±" style="width:100%;margin-top:10px;border-radius:8px;border:1px solid #ccc;padding:8px;">
    <textarea id="charPrompt" rows="4" placeholder="è§’è‰²æè¿° / Prompt" style="width:100%;margin-top:10px;border-radius:8px;border:1px solid #ccc;padding:8px;"></textarea>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;">
      <button onclick="saveCharacter()" style="background:#6f6fe0;color:white;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">ç¢ºå®š</button>
      <button onclick="closeModal('addCharModal')" style="background:#ccc;color:black;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">å–æ¶ˆ</button>
    </div>
  </dialog>

  <!-- ğŸ”¹è§’è‰²è©³æƒ… -->
  <dialog id="charModal" class="modal-box">
    <h3 id="charModalTitle">è§’è‰²åç¨± <button onclick="closeModal('charModal')">âœ•</button></h3>
    <p id="charModalText" style="margin-top:10px;white-space:pre-wrap;"></p>
    <button id="copyPromptBtn" onclick="copyPrompt()" style="margin-top:14px;background:#6f6fe0;color:white;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">ğŸ“‹ è¤‡è£½ Prompt</button>
  </dialog>

      <script type="module">
    // =============== Firebase åˆå§‹åŒ– ===============
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, deleteDoc, getDocs, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "ä½ çš„API_KEY",
      authDomain: "ä½ çš„å°ˆæ¡ˆID.firebaseapp.com",
      projectId: "ä½ çš„å°ˆæ¡ˆID",
      storageBucket: "ä½ çš„å°ˆæ¡ˆID.appspot.com",
      messagingSenderId: "ä½ çš„senderID",
      appId: "ä½ çš„appID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentCategory = "";

    // =============== ç™»å…¥ / ç™»å‡º ===============
    const loginBtn = document.getElementById("loginBtn");
    const userMenu = document.getElementById("userMenu");
    const logoutBtn = document.getElementById("logoutBtn");

    loginBtn.addEventListener("click", async () => {
      if (auth.currentUser) {
        userMenu.style.display = userMenu.style.display === "block" ? "none" : "block";
      } else {
        const email = prompt("è«‹è¼¸å…¥ä¿¡ç®±ï¼š");
        const password = prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š");
        if (email && password) {
          try {
            await signInWithEmailAndPassword(auth, email, password);
          } catch (err) {
            alert("ç™»å…¥å¤±æ•—ï¼š" + err.message);
          }
        }
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      userMenu.style.display = "none";
    });

    onAuthStateChanged(auth, user => {
      if (user) {
        loginBtn.textContent = user.email.split("@")[0];
        enableEditMode(true);
      } else {
        loginBtn.textContent = "ç™»å…¥";
        enableEditMode(false);
      }
    });

    // =============== ç·¨è¼¯æ¨¡å¼åˆ‡æ› ===============
    function enableEditMode(enabled) {
      document.querySelectorAll(".add-btn, .delete-cat-btn, .delete-char").forEach(btn => {
        btn.style.display = enabled ? "inline-flex" : "none";
      });
    }

    // =============== é¡¯ç¤ºå°è©±æ¡† ===============
    function openAddCharacterModal(category) {
      currentCategory = category;
      document.getElementById("charName").value = "";
      document.getElementById("charPrompt").value = "";
      document.getElementById("addCharModal").showModal();
    }

    function closeModal(id) {
      document.getElementById(id).close();
    }

    // =============== æ–°å¢è§’è‰²åˆ° Firestore ===============
    async function saveCharacter() {
      const name = document.getElementById("charName").value.trim();
      const prompt = document.getElementById("charPrompt").value.trim();
      if (!name) return alert("è«‹è¼¸å…¥åç¨±");
      try {
        await addDoc(collection(db, currentCategory), { name, prompt });
        closeModal("addCharModal");
      } catch (e) {
        console.error(e);
      }
    }

    // =============== é¡¯ç¤ºè§’è‰²è©³æƒ…å½ˆçª— ===============
    function showCharacter(name, prompt) {
      document.getElementById("charModalTitle").textContent = name;
      document.getElementById("charModalText").textContent = prompt || "(ç„¡æè¿°)";
      document.getElementById("charModal").showModal();
    }

    function copyPrompt() {
      const text = document.getElementById("charModalText").textContent;
      navigator.clipboard.writeText(text);
      alert("Prompt å·²è¤‡è£½ï¼");
    }

    // =============== åˆªé™¤è§’è‰²ï¼ˆç¢ºèªè¼¸å…¥ï¼‰ ===============
    async function deleteCharacter(category, id, name) {
      const confirmText = prompt(`ç¢ºèªåˆªé™¤è§’è‰²ã€Œ${name}ã€ï¼Ÿè«‹è¼¸å…¥ã€Œåˆªé™¤ã€ä»¥ç¢ºèªï¼š`);
      if (confirmText === "åˆªé™¤") {
        await deleteDoc(doc(db, category, id));
      }
    }

    // =============== Firestore å³æ™‚è®€å– ===============
    const categories = ["characters", "style", "outfit", "hair", "color"];
    categories.forEach(cat => {
      const listDiv = document.getElementById(`${cat}-list`);
      onSnapshot(collection(db, cat), snapshot => {
        listDiv.innerHTML = "";
        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          const item = document.createElement("div");
          item.className = "item";
          item.innerHTML = `
            ${data.name}
            <button class="delete-char" onclick="deleteCharacter('${cat}', '${docSnap.id}', '${data.name}')">âœ•</button>
          `;
          item.onclick = (e) => {
            if (e.target.tagName !== "BUTTON") showCharacter(data.name, data.prompt);
          };
          listDiv.appendChild(item);
        });
      });
    });

    // =============== å°å»ºè­° ===============
    const suggestBtn = document.getElementById("suggestBtn");
    suggestBtn.addEventListener("click", () => {
      closeModal("userMenu");
      document.getElementById("suggestModal").showModal();
    });

    async function submitSuggestion() {
      const text = document.getElementById("suggestText").value.trim();
      if (!text) return alert("è«‹è¼¸å…¥å»ºè­°å…§å®¹");
      try {
        await addDoc(collection(db, "suggestions"), { text, time: new Date().toISOString() });
        alert("æ„Ÿè¬æ‚¨çš„å»ºè­°ï¼");
        document.getElementById("suggestText").value = "";
        closeModal("suggestModal");
      } catch (err) {
        alert("æäº¤å¤±æ•—ï¼š" + err.message);
      }
    }

    // =============== å°è¦½åˆ—å®šä½æ»¾å‹• ===============
    function scrollToCategory(id) {
      document.getElementById(id).scrollIntoView({ behavior: "smooth" });
    }

    window.openAddCharacterModal = openAddCharacterModal;
    window.closeModal = closeModal;
    window.saveCharacter = saveCharacter;
    window.showCharacter = showCharacter;
    window.copyPrompt = copyPrompt;
    window.deleteCharacter = deleteCharacter;
    window.scrollToCategory = scrollToCategory;
    window.submitSuggestion = submitSuggestion;
  </script>
</body>
</html>
