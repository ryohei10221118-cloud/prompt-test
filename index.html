<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>角色提示管理工具 v3.0（雲端共享版）</title>

  <style>
    body {
      background: #f7f8fc;
      font-family: "Noto Sans TC", "Segoe UI", sans-serif;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #4b4ba5;
      color: #fff;
      padding: 12px 20px;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    header h1 {
      font-size: 1.4rem;
      font-weight: 700;
    }

    header .user-info {
      position: relative;
    }

    header .user-info button {
      background: #6f6fe0;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 6px 12px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.25s ease;
    }

    header .user-info button:hover {
      background: #5a5ad8;
    }

    /* ======= 下拉選單 ======= */
    #userMenu {
      position: absolute;
      right: 0;
      top: 40px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 8px 0;
      width: 140px;
      display: none;
      z-index: 20;
    }

    #userMenu ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #userMenu li {
      padding: 10px 14px;
      cursor: pointer;
      color: #333;
      font-weight: 500;
      transition: background 0.2s;
    }

    #userMenu li:hover {
      background: #f1f0ff;
      color: #4b4ba5;
    }

    /* ======= 導覽列 ======= */
    .nav-scroll {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      background: transparent;
      padding: 10px 16px;
      white-space: nowrap;
      border-bottom: 2px solid rgba(108, 99, 255, 0.3);
      position: sticky;
      top: 60px;
      z-index: 10;
    }

    .nav-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .nav-scroll::-webkit-scrollbar-thumb {
      background: rgba(108, 99, 255, 0.4);
      border-radius: 10px;
    }

    .nav-scroll button {
      background: rgba(108, 99, 255, 0.15);
      border: none;
      padding: 6px 14px;
      border-radius: 10px;
      font-weight: 600;
      color: #3a328f;
      cursor: pointer;
      transition: 0.2s;
    }

    .nav-scroll button:hover {
      background: rgba(108, 99, 255, 0.25);
      transform: translateY(-2px);
    }

    /* ======= 分類卡片 ======= */
    .category {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
      margin: 24px auto;
      padding: 18px 24px;
      width: 90%;
      max-width: 1000px;
      transition: all 0.3s ease;
    }

    .category h2 {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 1.1rem;
      color: #4b4ba5;
      border-bottom: 1px solid #ccc;
      padding-bottom: 6px;
    }

    .category-buttons {
      display: flex;
      gap: 10px;
    }

    .add-btn {
      background: #6f6fe0;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: 0.25s ease;
      font-weight: 600;
    }

    .add-btn:hover {
      background: #5b5bd0;
    }

    .delete-cat-btn {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      transition: 0.25s ease;
      font-weight: 600;
    }

    .delete-cat-btn:hover {
      background: #d03528;
    }

    /* ======= 角色小卡 ======= */
    .category-card {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .category-card .item {
      flex: 1 1 calc(50% - 10px);
      background: #f9f9ff;
      border: 1px solid #e0e0ff;
      border-radius: 12px;
      padding: 10px 14px;
      font-weight: 500;
      position: relative;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      cursor: pointer;
    }

    .category-card .item:hover {
      transform: translateY(-3px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    }

    .delete-char {
      position: absolute;
      top: 8px;
      right: 8px;
      background: none;
      border: none;
      color: #e74c3c;
      font-size: 1.1rem;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .delete-char:hover {
      transform: scale(1.2);
    }

    /* ======= 彈出視窗 ======= */
    .modal-box {
      background: linear-gradient(180deg, #ffffff, #f9f9ff);
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      padding: 20px 30px;
      max-width: 460px;
      width: 100%;
      margin: auto;
      border-top: 4px solid #6f6fe0;
    }

    .modal-box h3 {
      font-size: 1.25rem;
      font-weight: 700;
      color: #4b4ba5;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-box h3 button {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #999;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .modal-box h3 button:hover {
      color: #555;
    }

    @media (max-width: 768px) {
      .category-card .item {
        flex: 1 1 100%;
      }
      .nav-scroll button {
        font-size: 0.85rem;
        padding: 5px 10px;
      }
      .modal-box {
        width: 90%;
        padding: 16px;
      }
    }
  </style>
</head>

  <body>
  <header>
    <h1>角色提示管理工具 v3.0（雲端共享版）</h1>
    <div class="user-info">
      <button id="loginBtn">登入</button>
      <div id="userMenu" class="hidden">
        <ul>
          <li id="suggestBtn">💬 小建議</li>
          <li id="logoutBtn">登出</li>
        </ul>
      </div>
    </div>
  </header>

  <!-- 🔹導覽列 -->
  <div class="nav-scroll" id="navBar">
    <button onclick="scrollToCategory('characters')">角色描述</button>
    <button onclick="scrollToCategory('style')">光影風格</button>
    <button onclick="scrollToCategory('outfit')">服裝風格</button>
    <button onclick="scrollToCategory('hair')">髮型設計</button>
    <button onclick="scrollToCategory('color')">配色方案</button>
  </div>

  <!-- 🔹角色描述 -->
  <section id="characters" class="category">
    <h2>
      <span>🧍‍♂️ 角色描述</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('characters')">＋新增</button>
      </div>
    </h2>
    <div class="category-card" id="characters-list"></div>
  </section>

  <!-- 🔹光影風格 -->
  <section id="style" class="category">
    <h2>
      <span>🎨 光影風格</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('style')">＋新增</button>
      </div>
    </h2>
    <div class="category-card" id="style-list"></div>
  </section>

  <!-- 🔹服裝風格 -->
  <section id="outfit" class="category">
    <h2>
      <span>👗 服裝風格</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('outfit')">＋新增</button>
      </div>
    </h2>
    <div class="category-card" id="outfit-list"></div>
  </section>

  <!-- 🔹髮型設計 -->
  <section id="hair" class="category">
    <h2>
      <span>💇‍♀️ 髮型設計</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('hair')">＋新增</button>
      </div>
    </h2>
    <div class="category-card" id="hair-list"></div>
  </section>

  <!-- 🔹配色方案 -->
  <section id="color" class="category">
    <h2>
      <span>🎨 配色方案</span>
      <div class="category-buttons">
        <button class="add-btn" onclick="openAddCharacterModal('color')">＋新增</button>
      </div>
    </h2>
    <div class="category-card" id="color-list"></div>
  </section>

  <!-- 🔹小建議 -->
  <dialog id="suggestModal" class="modal-box">
    <h3>💬 小建議 <button onclick="closeModal('suggestModal')">✕</button></h3>
    <textarea id="suggestText" rows="4" placeholder="請輸入您的建議..." style="width:100%;margin-top:10px;border-radius:8px;border:1px solid #ccc;padding:8px;"></textarea>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;">
      <button onclick="submitSuggestion()" style="background:#6f6fe0;color:white;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">送出</button>
      <button onclick="closeModal('suggestModal')" style="background:#ccc;color:black;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">取消</button>
    </div>
  </dialog>

  <!-- 🔹新增角色 -->
  <dialog id="addCharModal" class="modal-box">
    <h3>新增角色 <button onclick="closeModal('addCharModal')">✕</button></h3>
    <input type="text" id="charName" placeholder="角色名稱" style="width:100%;margin-top:10px;border-radius:8px;border:1px solid #ccc;padding:8px;">
    <textarea id="charPrompt" rows="4" placeholder="角色描述 / Prompt" style="width:100%;margin-top:10px;border-radius:8px;border:1px solid #ccc;padding:8px;"></textarea>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;">
      <button onclick="saveCharacter()" style="background:#6f6fe0;color:white;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">確定</button>
      <button onclick="closeModal('addCharModal')" style="background:#ccc;color:black;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">取消</button>
    </div>
  </dialog>

  <!-- 🔹角色詳情 -->
  <dialog id="charModal" class="modal-box">
    <h3 id="charModalTitle">角色名稱 <button onclick="closeModal('charModal')">✕</button></h3>
    <p id="charModalText" style="margin-top:10px;white-space:pre-wrap;"></p>
    <button id="copyPromptBtn" onclick="copyPrompt()" style="margin-top:14px;background:#6f6fe0;color:white;padding:6px 16px;border:none;border-radius:6px;cursor:pointer;">📋 複製 Prompt</button>
  </dialog>

      <script type="module">
    // =============== Firebase 初始化 ===============
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, deleteDoc, getDocs, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "你的API_KEY",
      authDomain: "你的專案ID.firebaseapp.com",
      projectId: "你的專案ID",
      storageBucket: "你的專案ID.appspot.com",
      messagingSenderId: "你的senderID",
      appId: "你的appID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentCategory = "";

    // =============== 登入 / 登出 ===============
    const loginBtn = document.getElementById("loginBtn");
    const userMenu = document.getElementById("userMenu");
    const logoutBtn = document.getElementById("logoutBtn");

    loginBtn.addEventListener("click", async () => {
      if (auth.currentUser) {
        userMenu.style.display = userMenu.style.display === "block" ? "none" : "block";
      } else {
        const email = prompt("請輸入信箱：");
        const password = prompt("請輸入密碼：");
        if (email && password) {
          try {
            await signInWithEmailAndPassword(auth, email, password);
          } catch (err) {
            alert("登入失敗：" + err.message);
          }
        }
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      userMenu.style.display = "none";
    });

    onAuthStateChanged(auth, user => {
      if (user) {
        loginBtn.textContent = user.email.split("@")[0];
        enableEditMode(true);
      } else {
        loginBtn.textContent = "登入";
        enableEditMode(false);
      }
    });

    // =============== 編輯模式切換 ===============
    function enableEditMode(enabled) {
      document.querySelectorAll(".add-btn, .delete-cat-btn, .delete-char").forEach(btn => {
        btn.style.display = enabled ? "inline-flex" : "none";
      });
    }

    // =============== 顯示對話框 ===============
    function openAddCharacterModal(category) {
      currentCategory = category;
      document.getElementById("charName").value = "";
      document.getElementById("charPrompt").value = "";
      document.getElementById("addCharModal").showModal();
    }

    function closeModal(id) {
      document.getElementById(id).close();
    }

    // =============== 新增角色到 Firestore ===============
    async function saveCharacter() {
      const name = document.getElementById("charName").value.trim();
      const prompt = document.getElementById("charPrompt").value.trim();
      if (!name) return alert("請輸入名稱");
      try {
        await addDoc(collection(db, currentCategory), { name, prompt });
        closeModal("addCharModal");
      } catch (e) {
        console.error(e);
      }
    }

    // =============== 顯示角色詳情彈窗 ===============
    function showCharacter(name, prompt) {
      document.getElementById("charModalTitle").textContent = name;
      document.getElementById("charModalText").textContent = prompt || "(無描述)";
      document.getElementById("charModal").showModal();
    }

    function copyPrompt() {
      const text = document.getElementById("charModalText").textContent;
      navigator.clipboard.writeText(text);
      alert("Prompt 已複製！");
    }

    // =============== 刪除角色（確認輸入） ===============
    async function deleteCharacter(category, id, name) {
      const confirmText = prompt(`確認刪除角色「${name}」？請輸入「刪除」以確認：`);
      if (confirmText === "刪除") {
        await deleteDoc(doc(db, category, id));
      }
    }

    // =============== Firestore 即時讀取 ===============
    const categories = ["characters", "style", "outfit", "hair", "color"];
    categories.forEach(cat => {
      const listDiv = document.getElementById(`${cat}-list`);
      onSnapshot(collection(db, cat), snapshot => {
        listDiv.innerHTML = "";
        snapshot.forEach(docSnap => {
          const data = docSnap.data();
          const item = document.createElement("div");
          item.className = "item";
          item.innerHTML = `
            ${data.name}
            <button class="delete-char" onclick="deleteCharacter('${cat}', '${docSnap.id}', '${data.name}')">✕</button>
          `;
          item.onclick = (e) => {
            if (e.target.tagName !== "BUTTON") showCharacter(data.name, data.prompt);
          };
          listDiv.appendChild(item);
        });
      });
    });

    // =============== 小建議 ===============
    const suggestBtn = document.getElementById("suggestBtn");
    suggestBtn.addEventListener("click", () => {
      closeModal("userMenu");
      document.getElementById("suggestModal").showModal();
    });

    async function submitSuggestion() {
      const text = document.getElementById("suggestText").value.trim();
      if (!text) return alert("請輸入建議內容");
      try {
        await addDoc(collection(db, "suggestions"), { text, time: new Date().toISOString() });
        alert("感謝您的建議！");
        document.getElementById("suggestText").value = "";
        closeModal("suggestModal");
      } catch (err) {
        alert("提交失敗：" + err.message);
      }
    }

    // =============== 導覽列定位滾動 ===============
    function scrollToCategory(id) {
      document.getElementById(id).scrollIntoView({ behavior: "smooth" });
    }

    window.openAddCharacterModal = openAddCharacterModal;
    window.closeModal = closeModal;
    window.saveCharacter = saveCharacter;
    window.showCharacter = showCharacter;
    window.copyPrompt = copyPrompt;
    window.deleteCharacter = deleteCharacter;
    window.scrollToCategory = scrollToCategory;
    window.submitSuggestion = submitSuggestion;
  </script>
</body>
</html>
